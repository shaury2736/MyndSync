{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <aside class="sidebar">
        <a href="/dashboard">Dashboard</a>
        <a href="/search">Search Notes</a>
        <a href="/ai-assist">AI Assistance</a>
        <a href="/upload" class="active">Upload Files</a>
        <a href="/library">My Library</a>
    </aside>

    <main class="main-content">
        <div style="margin-bottom: 2rem;">
            <h2 style="font-size: 1.75rem; color: var(--text-main); margin-bottom: 0.5rem;">Upload Your Material</h2>
            <p style="color: var(--text-muted);">Share your academic resources with the student community.</p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem;">
            <!-- Upload Notes Box -->
            <div class="card"
                style="display: flex; flex-direction: column; border-top: 4px solid var(--primary-color);">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.25rem;">Upload Notes</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">Lecture notes, study guides, or summaries.
                    </p>
                </div>
                <form class="upload-form" data-type="note"
                    style="flex: 1; display: flex; flex-direction: column; gap: 1rem;">
                    <input type="text" name="subjectName" placeholder="Subject Name" required
                        style="width: 100%; padding: 0.8rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; outline: none;">
                    <input type="text" name="department" placeholder="Department (e.g., CSE, ECE)" required
                        style="width: 100%; padding: 0.8rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; outline: none;">
                    <div
                        style="border: 2px dashed var(--border-color); padding: 1.5rem; border-radius: 8px; text-align: center; background: #f8fafc;">
                        <input type="file" name="file" accept=".pdf,.docx" required
                            style="font-size: 0.9rem; color: var(--text-muted);">
                    </div>
                    <button type="submit" class="cta-button"
                        style="width: 100%; padding: 0.8rem; margin-top: auto;">Upload Note</button>
                    <div class="status-div" style="font-size: 0.9rem; text-align: center;"></div>
                </form>
            </div>

            <!-- Upload PYQ Box -->
            <div class="card" style="display: flex; flex-direction: column; border-top: 4px solid var(--accent-color);">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.25rem;">Upload PYQ</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">Previous year questions and exam papers.</p>
                </div>
                <form class="upload-form" data-type="pyq"
                    style="flex: 1; display: flex; flex-direction: column; gap: 1rem;">
                    <input type="text" name="subjectName" placeholder="Subject Name" required
                        style="width: 100%; padding: 0.8rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; outline: none;">
                    <input type="text" name="department" placeholder="Department (e.g., CSE, ECE)" required
                        style="width: 100%; padding: 0.8rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; outline: none;">
                    <div
                        style="border: 2px dashed var(--border-color); padding: 1.5rem; border-radius: 8px; text-align: center; background: #f8fafc;">
                        <input type="file" name="file" accept=".pdf,.docx" required
                            style="font-size: 0.9rem; color: var(--text-muted);">
                    </div>
                    <button type="submit" class="cta-button"
                        style="width: 100%; padding: 0.8rem; background: var(--accent-color); margin-top: auto;">Upload
                        PYQ</button>
                    <div class="status-div" style="font-size: 0.9rem; text-align: center;"></div>
                </form>
            </div>
        </div>
    </main>
</div>

<script>
    document.querySelectorAll('.upload-form').forEach(form => {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = form.querySelector('button');
            const status = form.querySelector('.status-div');
            const type = form.getAttribute('data-type');

            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = "Uploading...";
            status.textContent = "Uploading to storage...";

            const formData = new FormData(form);
            formData.append('fileType', type);

            try {
                const response = await fetch('/upload_file', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (response.ok) {
                    status.innerHTML = `<p style="color: green;">${result.message}</p>`;
                    setTimeout(() => window.location.href = '/library', 2000);
                } else {
                    status.innerHTML = `<p style="color: red;">Error: ${result.error}</p>`;
                }
            } catch (error) {
                status.innerHTML = `<p style="color: red;">${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        });
    });
</script>
{% endblock %}