{% extends "base.html" %}

{% block content %}
<div
    style="min-height: 100%; display: flex; align-items: flex-start; justify-content: center; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 4rem 2rem;">
    <div class="auth-container"
        style="margin: 0; width: 100%; max-width: 450px; padding: 3rem; background: var(--white); box-shadow: 0 20px 50px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.05); border-radius: 12px;">
        <div style="margin-bottom: 2rem; text-align: center;">
            <div style="font-size: 2.5rem; margin-bottom: 1rem;">ðŸ“š</div>
            <h2 style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--primary-color);">Welcome Back</h2>
            <p style="color: var(--text-muted);">Sign in to your NoteStack workspace</p>
        </div>
        <form id="login-form">
            <div style="margin-bottom: 1.25rem;">
                <label
                    style="display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); margin-bottom: 0.5rem; text-align: left;">Email
                    Address</label>
                <input type="email" id="email" required
                    style="width: 100%; padding: 0.9rem 1.2rem; border: 1px solid var(--border-color); border-radius: 10px; font-size: 1rem; outline: none; transition: border-color 0.2s;">
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label
                    style="display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); margin-bottom: 0.5rem; text-align: left;">Password</label>
                <input type="password" id="password" required
                    style="width: 100%; padding: 0.9rem 1.2rem; border: 1px solid var(--border-color); border-radius: 10px; font-size: 1rem; outline: none; transition: border-color 0.2s;">
            </div>
            <button type="submit"
                style="width: 100%; padding: 1rem; background: var(--primary-color); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s, background 0.2s;">Sign
                In</button>
        </form>
        <p id="error-message"
            style="color: var(--error-color); margin-top: 1.5rem; font-size: 0.9rem; font-weight: 500; min-height: 1.2rem;">
        </p>
        <div
            style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.95rem;">New to NoteStack? <a href="/register"
                    style="color: var(--primary-color); font-weight: 600; text-decoration: none;">Create an account</a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const loginForm = document.getElementById('login-form');
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        console.log('Login form submitted');
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        firebase.auth().signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                console.log('Firebase sign in success');
                // Get ID token and send to backend
                userCredential.user.getIdToken().then((idToken) => {
                    console.log('Got idToken');
                    fetch('/session_login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ idToken: idToken.toString() })
                    }).then(response => {
                        console.log('Fetch response:', response.status);
                        if (!response.ok) throw new Error('Login failed on server');
                        loginForm.reset();
                        window.location.href = '/dashboard';
                    }).catch((error) => {
                        console.error('Fetch error:', error);
                        document.getElementById('error-message').textContent = 'Login failed: ' + error.message;
                    });
                });
            })
            .catch((error) => {
                console.error('Firebase error:', error);
                document.getElementById('error-message').textContent = error.message;
            });
    });
</script>
{% endblock %}